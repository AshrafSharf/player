var Mask = (function () {
    function Mask(stage, renderer) {
        this._stage = stage;
        this._renderer = renderer;
        //this._texture = new RenderTexture(renderer.width, renderer.height);
    }
    //public get texture()
    //{
    //return this._texture;
    //}
    //public dispose()
    //{
    //    this._texture.dispose();
    //}
    Mask.prototype.registerMask = function (obj) {
        this._registeredMasks.push(obj);
    };
    Mask.prototype.renderMasks = function (masks, configID) {
        //var oldRenderTarget = this._stage.renderTarget;
        //this._stage.setRenderTarget(this._texture);
        //this._stage.clear();
        var context = this._stage.context;
        context.setColorMask(false, false, false, false);
        // TODO: Could we create masks within masks by providing a previous configID, and supply "clear/keep" on stencil fail
        context.setStencilActions("frontAndBack", "always", "set", "set", "set");
        if (masks) {
            var numMasks = masks.length;
            var numRenderables = this._registeredMasks.length;
            for (var i = 0; i < numMasks; ++i) {
                var mask = masks[i];
                for (var j = 0; j < numRenderables; ++j) {
                    var obj = this._registeredMasks[j];
                    if (obj.sourceEntity["hierarchicalMaskID"] === mask["hierarchicalMaskID"]) {
                        console.log("Rendering hierarchicalMaskID " + mask["hierarchicalMaskID"]);
                        this._draw(obj);
                    }
                }
            }
        }
        context.setColorMask(true, true, true, true);
        //this._stage.setRenderTarget(oldRenderTarget);
    };
    Mask.prototype.reset = function () {
        this._registeredMasks = [];
    };
    /*    public get width() : number
        {
            return this._texture.width;
        }
    
        public set width(value:number)
        {
            this._texture.width = value;
        }
    
        public get height() : number
        {
            return this._texture.height;
        }
    
        public set height(value:number)
        {
            this._texture.height = value;
        }*/
    Mask.prototype._draw = function (renderable) {
        var renderObject = renderable.renderObject;
        var passes = renderObject.passes;
        var len = passes.length;
        var pass = passes[len - 1];
        var camera = this._renderer._pCamera;
        this._renderer.activatePass(renderable, pass, camera);
        // only render last pass for now
        renderable._iRender(pass, camera, this._renderer._pRttViewProjectionMatrix);
        this._renderer.deactivatePass(renderable, pass);
    };
    return Mask;
})();
module.exports = Mask;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1wbGF5ZXIvbGliL3JlbmRlcmVyL01hc2sudHMiXSwibmFtZXMiOlsiTWFzayIsIk1hc2suY29uc3RydWN0b3IiLCJNYXNrLnJlZ2lzdGVyTWFzayIsIk1hc2sucmVuZGVyTWFza3MiLCJNYXNrLnJlc2V0IiwiTWFzay5fZHJhdyJdLCJtYXBwaW5ncyI6IkFBUUEsSUFBTSxJQUFJO0lBT05BLFNBUEVBLElBQUlBLENBT01BLEtBQVdBLEVBQUVBLFFBQW1CQTtRQUV4Q0MsSUFBSUEsQ0FBQ0EsTUFBTUEsR0FBR0EsS0FBS0EsQ0FBQ0E7UUFDcEJBLElBQUlBLENBQUNBLFNBQVNBLEdBQUdBLFFBQVFBLENBQUNBO1FBQzFCQSxxRUFBcUVBO0lBQ3pFQSxDQUFDQTtJQUVERCxzQkFBc0JBO0lBQ3RCQSxHQUFHQTtJQUNDQSx1QkFBdUJBO0lBQzNCQSxHQUFHQTtJQUVIQSxrQkFBa0JBO0lBQ2xCQSxHQUFHQTtJQUNIQSw4QkFBOEJBO0lBQzlCQSxHQUFHQTtJQUVJQSwyQkFBWUEsR0FBbkJBLFVBQW9CQSxHQUFrQkE7UUFFbENFLElBQUlBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7SUFDcENBLENBQUNBO0lBRU1GLDBCQUFXQSxHQUFsQkEsVUFBbUJBLEtBQXFCQSxFQUFFQSxRQUFlQTtRQUVyREcsaURBQWlEQTtRQUVqREEsQUFFQUEsNkNBRjZDQTtRQUM3Q0Esc0JBQXNCQTtZQUNsQkEsT0FBT0EsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsT0FBT0EsQ0FBQ0E7UUFDbENBLE9BQU9BLENBQUNBLFlBQVlBLENBQUNBLEtBQUtBLEVBQUVBLEtBQUtBLEVBQUVBLEtBQUtBLEVBQUVBLEtBQUtBLENBQUNBLENBQUNBO1FBQ2pEQSxBQUNBQSxxSEFEcUhBO1FBQ3JIQSxPQUFPQSxDQUFDQSxpQkFBaUJBLENBQUNBLGNBQWNBLEVBQUVBLFFBQVFBLEVBQUVBLEtBQUtBLEVBQUVBLEtBQUtBLEVBQUVBLEtBQUtBLENBQUNBLENBQUNBO1FBRXpFQSxFQUFFQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNSQSxJQUFJQSxRQUFRQSxHQUFHQSxLQUFLQSxDQUFDQSxNQUFNQSxDQUFDQTtZQUM1QkEsSUFBSUEsY0FBY0EsR0FBR0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxNQUFNQSxDQUFDQTtZQUVsREEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsUUFBUUEsRUFBRUEsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0E7Z0JBQ2hDQSxJQUFJQSxJQUFJQSxHQUFHQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDcEJBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLGNBQWNBLEVBQUVBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBO29CQUN0Q0EsSUFBSUEsR0FBR0EsR0FBR0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtvQkFDbkNBLEVBQUVBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLFlBQVlBLENBQUNBLG9CQUFvQkEsQ0FBQ0EsS0FBS0EsSUFBSUEsQ0FBQ0Esb0JBQW9CQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTt3QkFDeEVBLE9BQU9BLENBQUNBLEdBQUdBLENBQUNBLCtCQUErQkEsR0FBR0EsSUFBSUEsQ0FBQ0Esb0JBQW9CQSxDQUFDQSxDQUFDQSxDQUFDQTt3QkFDMUVBLElBQUlBLENBQUNBLEtBQUtBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBO29CQUNwQkEsQ0FBQ0E7Z0JBQ0xBLENBQUNBO1lBQ0xBLENBQUNBO1FBQ0xBLENBQUNBO1FBRURBLE9BQU9BLENBQUNBLFlBQVlBLENBQUNBLElBQUlBLEVBQUVBLElBQUlBLEVBQUVBLElBQUlBLEVBQUVBLElBQUlBLENBQUNBLENBQUNBO1FBQzdDQSwrQ0FBK0NBO0lBQ25EQSxDQUFDQTtJQUVNSCxvQkFBS0EsR0FBWkE7UUFFSUksSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxHQUFHQSxFQUFFQSxDQUFDQTtJQUMvQkEsQ0FBQ0E7SUFFTEo7Ozs7Ozs7Ozs7Ozs7Ozs7OztXQWtCT0E7SUFFS0Esb0JBQUtBLEdBQWJBLFVBQWNBLFVBQXlCQTtRQUVuQ0ssSUFBSUEsWUFBWUEsR0FBR0EsVUFBVUEsQ0FBQ0EsWUFBWUEsQ0FBQ0E7UUFDM0NBLElBQUlBLE1BQU1BLEdBQUdBLFlBQVlBLENBQUNBLE1BQU1BLENBQUNBO1FBQ2pDQSxJQUFJQSxHQUFHQSxHQUFHQSxNQUFNQSxDQUFDQSxNQUFNQSxDQUFDQTtRQUN4QkEsSUFBSUEsSUFBSUEsR0FBR0EsTUFBTUEsQ0FBQ0EsR0FBR0EsR0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7UUFDekJBLElBQUlBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLFFBQVFBLENBQUNBO1FBRXJDQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxZQUFZQSxDQUFDQSxVQUFVQSxFQUFFQSxJQUFJQSxFQUFFQSxNQUFNQSxDQUFDQSxDQUFDQTtRQUN0REEsQUFDQUEsZ0NBRGdDQTtRQUNoQ0EsVUFBVUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsSUFBSUEsRUFBRUEsTUFBTUEsRUFBRUEsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EseUJBQXlCQSxDQUFDQSxDQUFDQTtRQUM1RUEsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsY0FBY0EsQ0FBQ0EsVUFBVUEsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7SUFDcERBLENBQUNBO0lBQ0xMLFdBQUNBO0FBQURBLENBbEdBLEFBa0dDQSxJQUFBO0FBQ0QsQUFBYyxpQkFBTCxJQUFJLENBQUMiLCJmaWxlIjoicmVuZGVyZXIvTWFzay5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVuZGVyVGV4dHVyZSA9IHJlcXVpcmUoXCJhd2F5anMtY29yZS9saWIvdGV4dHVyZXMvUmVuZGVyVGV4dHVyZVwiKTtcclxuaW1wb3J0IERpc3BsYXlPYmplY3QgPSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2Jhc2UvRGlzcGxheU9iamVjdFwiKTtcclxuaW1wb3J0IFJlbmRlcmFibGVCYXNlID0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9wb29sL1JlbmRlcmFibGVCYXNlXCIpO1xyXG5pbXBvcnQgUmVuZGVyT2JqZWN0QmFzZVx0PSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1JlbmRlck9iamVjdEJhc2VcIik7XHJcbmltcG9ydCBTdGFnZSA9IHJlcXVpcmUoXCJhd2F5anMtc3RhZ2VnbC9saWIvYmFzZS9TdGFnZVwiKTtcclxuXHJcbmltcG9ydCBSZW5kZXJlcjJEID0gcmVxdWlyZShcImF3YXlqcy1wbGF5ZXIvbGliL3JlbmRlcmVyL1JlbmRlcmVyMkRcIik7XHJcblxyXG5jbGFzcyBNYXNrXHJcbntcclxuICAgIC8vcHJpdmF0ZSBfdGV4dHVyZSA6IFJlbmRlclRleHR1cmU7XHJcbiAgICBwcml2YXRlIF9zdGFnZSA6IFN0YWdlO1xyXG4gICAgcHJpdmF0ZSBfcmVuZGVyZXIgOiBSZW5kZXJlcjJEO1xyXG4gICAgcHJpdmF0ZSBfcmVnaXN0ZXJlZE1hc2tzIDogUmVuZGVyYWJsZUJhc2VbXTtcclxuXHJcbiAgICBjb25zdHJ1Y3RvcihzdGFnZTpTdGFnZSwgcmVuZGVyZXI6UmVuZGVyZXIyRClcclxuICAgIHtcclxuICAgICAgICB0aGlzLl9zdGFnZSA9IHN0YWdlO1xyXG4gICAgICAgIHRoaXMuX3JlbmRlcmVyID0gcmVuZGVyZXI7XHJcbiAgICAgICAgLy90aGlzLl90ZXh0dXJlID0gbmV3IFJlbmRlclRleHR1cmUocmVuZGVyZXIud2lkdGgsIHJlbmRlcmVyLmhlaWdodCk7XHJcbiAgICB9XHJcblxyXG4gICAgLy9wdWJsaWMgZ2V0IHRleHR1cmUoKVxyXG4gICAgLy97XHJcbiAgICAgICAgLy9yZXR1cm4gdGhpcy5fdGV4dHVyZTtcclxuICAgIC8vfVxyXG5cclxuICAgIC8vcHVibGljIGRpc3Bvc2UoKVxyXG4gICAgLy97XHJcbiAgICAvLyAgICB0aGlzLl90ZXh0dXJlLmRpc3Bvc2UoKTtcclxuICAgIC8vfVxyXG5cclxuICAgIHB1YmxpYyByZWdpc3Rlck1hc2sob2JqOlJlbmRlcmFibGVCYXNlKSA6IHZvaWRcclxuICAgIHtcclxuICAgICAgICB0aGlzLl9yZWdpc3RlcmVkTWFza3MucHVzaChvYmopO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyByZW5kZXJNYXNrcyhtYXNrczpEaXNwbGF5T2JqZWN0W10sIGNvbmZpZ0lEOm51bWJlcilcclxuICAgIHtcclxuICAgICAgICAvL3ZhciBvbGRSZW5kZXJUYXJnZXQgPSB0aGlzLl9zdGFnZS5yZW5kZXJUYXJnZXQ7XHJcblxyXG4gICAgICAgIC8vdGhpcy5fc3RhZ2Uuc2V0UmVuZGVyVGFyZ2V0KHRoaXMuX3RleHR1cmUpO1xyXG4gICAgICAgIC8vdGhpcy5fc3RhZ2UuY2xlYXIoKTtcclxuICAgICAgICB2YXIgY29udGV4dCA9IHRoaXMuX3N0YWdlLmNvbnRleHQ7XHJcbiAgICAgICAgY29udGV4dC5zZXRDb2xvck1hc2soZmFsc2UsIGZhbHNlLCBmYWxzZSwgZmFsc2UpO1xyXG4gICAgICAgIC8vIFRPRE86IENvdWxkIHdlIGNyZWF0ZSBtYXNrcyB3aXRoaW4gbWFza3MgYnkgcHJvdmlkaW5nIGEgcHJldmlvdXMgY29uZmlnSUQsIGFuZCBzdXBwbHkgXCJjbGVhci9rZWVwXCIgb24gc3RlbmNpbCBmYWlsXHJcbiAgICAgICAgY29udGV4dC5zZXRTdGVuY2lsQWN0aW9ucyhcImZyb250QW5kQmFja1wiLCBcImFsd2F5c1wiLCBcInNldFwiLCBcInNldFwiLCBcInNldFwiKTtcclxuXHJcbiAgICAgICAgaWYgKG1hc2tzKSB7XHJcbiAgICAgICAgICAgIHZhciBudW1NYXNrcyA9IG1hc2tzLmxlbmd0aDtcclxuICAgICAgICAgICAgdmFyIG51bVJlbmRlcmFibGVzID0gdGhpcy5fcmVnaXN0ZXJlZE1hc2tzLmxlbmd0aDtcclxuXHJcbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbnVtTWFza3M7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIG1hc2sgPSBtYXNrc1tpXTtcclxuICAgICAgICAgICAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgbnVtUmVuZGVyYWJsZXM7ICsraikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBvYmogPSB0aGlzLl9yZWdpc3RlcmVkTWFza3Nbal07XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG9iai5zb3VyY2VFbnRpdHlbXCJoaWVyYXJjaGljYWxNYXNrSURcIl0gPT09IG1hc2tbXCJoaWVyYXJjaGljYWxNYXNrSURcIl0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJSZW5kZXJpbmcgaGllcmFyY2hpY2FsTWFza0lEIFwiICsgbWFza1tcImhpZXJhcmNoaWNhbE1hc2tJRFwiXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2RyYXcob2JqKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnRleHQuc2V0Q29sb3JNYXNrKHRydWUsIHRydWUsIHRydWUsIHRydWUpO1xyXG4gICAgICAgIC8vdGhpcy5fc3RhZ2Uuc2V0UmVuZGVyVGFyZ2V0KG9sZFJlbmRlclRhcmdldCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHJlc2V0KClcclxuICAgIHtcclxuICAgICAgICB0aGlzLl9yZWdpc3RlcmVkTWFza3MgPSBbXTtcclxuICAgIH1cclxuXHJcbi8qICAgIHB1YmxpYyBnZXQgd2lkdGgoKSA6IG51bWJlclxyXG4gICAge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl90ZXh0dXJlLndpZHRoO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzZXQgd2lkdGgodmFsdWU6bnVtYmVyKVxyXG4gICAge1xyXG4gICAgICAgIHRoaXMuX3RleHR1cmUud2lkdGggPSB2YWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0IGhlaWdodCgpIDogbnVtYmVyXHJcbiAgICB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3RleHR1cmUuaGVpZ2h0O1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzZXQgaGVpZ2h0KHZhbHVlOm51bWJlcilcclxuICAgIHtcclxuICAgICAgICB0aGlzLl90ZXh0dXJlLmhlaWdodCA9IHZhbHVlO1xyXG4gICAgfSovXHJcblxyXG4gICAgcHJpdmF0ZSBfZHJhdyhyZW5kZXJhYmxlOlJlbmRlcmFibGVCYXNlKVxyXG4gICAge1xyXG4gICAgICAgIHZhciByZW5kZXJPYmplY3QgPSByZW5kZXJhYmxlLnJlbmRlck9iamVjdDtcclxuICAgICAgICB2YXIgcGFzc2VzID0gcmVuZGVyT2JqZWN0LnBhc3NlcztcclxuICAgICAgICB2YXIgbGVuID0gcGFzc2VzLmxlbmd0aDtcclxuICAgICAgICB2YXIgcGFzcyA9IHBhc3Nlc1tsZW4tMV07XHJcbiAgICAgICAgdmFyIGNhbWVyYSA9IHRoaXMuX3JlbmRlcmVyLl9wQ2FtZXJhO1xyXG5cclxuICAgICAgICB0aGlzLl9yZW5kZXJlci5hY3RpdmF0ZVBhc3MocmVuZGVyYWJsZSwgcGFzcywgY2FtZXJhKTtcclxuICAgICAgICAvLyBvbmx5IHJlbmRlciBsYXN0IHBhc3MgZm9yIG5vd1xyXG4gICAgICAgIHJlbmRlcmFibGUuX2lSZW5kZXIocGFzcywgY2FtZXJhLCB0aGlzLl9yZW5kZXJlci5fcFJ0dFZpZXdQcm9qZWN0aW9uTWF0cml4KTtcclxuICAgICAgICB0aGlzLl9yZW5kZXJlci5kZWFjdGl2YXRlUGFzcyhyZW5kZXJhYmxlLCBwYXNzKTtcclxuICAgIH1cclxufVxyXG5leHBvcnQgPSBNYXNrO1xyXG4iXX0=