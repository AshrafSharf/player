var Mask = (function () {
    function Mask(stage, renderer) {
        this._stage = stage;
        this._renderer = renderer;
        //this._texture = new RenderTexture(renderer.width, renderer.height);
    }
    //public get texture()
    //{
    //return this._texture;
    //}
    //public dispose()
    //{
    //    this._texture.dispose();
    //}
    Mask.prototype.registerMask = function (obj) {
        //console.log("registerMask");
        this._registeredMasks.push(obj);
    };
    Mask.prototype.renderMasks = function (masks) {
        //var oldRenderTarget = this._stage.renderTarget;
        //this._stage.setRenderTarget(this._texture);
        //this._stage.clear();
        var context = this._stage.context;
        context.setColorMask(false, false, false, false);
        // TODO: Could we create masks within masks by providing a previous configID, and supply "clear/keep" on stencil fail
        //context.setStencilActions("frontAndBack", "always", "set", "set", "set");
        if (masks) {
            var numMasks = masks.length;
            var numRenderables = this._registeredMasks.length;
            for (var i = 0; i < numMasks; ++i) {
                var mask = masks[i];
                for (var j = 0; j < numRenderables; ++j) {
                    var obj = this._registeredMasks[j];
                    if (obj.sourceEntity["hierarchicalMaskID"] === mask["hierarchicalMaskID"]) {
                        //console.log("Rendering hierarchicalMaskID " + mask["hierarchicalMaskID"]);
                        this._draw(obj);
                    }
                }
            }
        }
        context.setColorMask(true, true, true, true);
        //this._stage.setRenderTarget(oldRenderTarget);
    };
    Mask.prototype.reset = function () {
        this._registeredMasks = [];
    };
    /*    public get width() : number
        {
            return this._texture.width;
        }
    
        public set width(value:number)
        {
            this._texture.width = value;
        }
    
        public get height() : number
        {
            return this._texture.height;
        }
    
        public set height(value:number)
        {
            this._texture.height = value;
        }*/
    Mask.prototype._draw = function (renderable) {
        var renderObject = renderable.renderObject;
        var passes = renderObject.passes;
        var len = passes.length;
        var pass = passes[len - 1];
        var camera = this._renderer._pCamera;
        this._renderer.activatePass(renderable, pass, camera);
        // only render last pass for now
        renderable._iRender(pass, camera, this._renderer._pRttViewProjectionMatrix);
        this._renderer.deactivatePass(renderable, pass);
    };
    return Mask;
})();
module.exports = Mask;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1wbGF5ZXIvbGliL3JlbmRlcmVyL01hc2sudHMiXSwibmFtZXMiOlsiTWFzayIsIk1hc2suY29uc3RydWN0b3IiLCJNYXNrLnJlZ2lzdGVyTWFzayIsIk1hc2sucmVuZGVyTWFza3MiLCJNYXNrLnJlc2V0IiwiTWFzay5fZHJhdyJdLCJtYXBwaW5ncyI6IkFBU0EsSUFBTSxJQUFJO0lBT05BLFNBUEVBLElBQUlBLENBT01BLEtBQVdBLEVBQUVBLFFBQW1CQTtRQUV4Q0MsSUFBSUEsQ0FBQ0EsTUFBTUEsR0FBR0EsS0FBS0EsQ0FBQ0E7UUFDcEJBLElBQUlBLENBQUNBLFNBQVNBLEdBQUdBLFFBQVFBLENBQUNBO1FBQzFCQSxxRUFBcUVBO0lBQ3pFQSxDQUFDQTtJQUVERCxzQkFBc0JBO0lBQ3RCQSxHQUFHQTtJQUNDQSx1QkFBdUJBO0lBQzNCQSxHQUFHQTtJQUVIQSxrQkFBa0JBO0lBQ2xCQSxHQUFHQTtJQUNIQSw4QkFBOEJBO0lBQzlCQSxHQUFHQTtJQUVJQSwyQkFBWUEsR0FBbkJBLFVBQW9CQSxHQUFrQkE7UUFFbENFLEFBQ0FBLDhCQUQ4QkE7UUFDOUJBLElBQUlBLENBQUNBLGdCQUFnQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0E7SUFDcENBLENBQUNBO0lBRU1GLDBCQUFXQSxHQUFsQkEsVUFBbUJBLEtBQXFCQTtRQUVwQ0csaURBQWlEQTtRQUVqREEsQUFFQUEsNkNBRjZDQTtRQUM3Q0Esc0JBQXNCQTtZQUNsQkEsT0FBT0EsR0FBR0EsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsT0FBT0EsQ0FBQ0E7UUFDbENBLE9BQU9BLENBQUNBLFlBQVlBLENBQUNBLEtBQUtBLEVBQUVBLEtBQUtBLEVBQUVBLEtBQUtBLEVBQUVBLEtBQUtBLENBQUNBLENBQUNBO1FBQ2pEQSxBQUdBQSxxSEFIcUhBO1FBQ3JIQSwyRUFBMkVBO1FBRTNFQSxFQUFFQSxDQUFDQSxDQUFDQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQTtZQUNSQSxJQUFJQSxRQUFRQSxHQUFHQSxLQUFLQSxDQUFDQSxNQUFNQSxDQUFDQTtZQUM1QkEsSUFBSUEsY0FBY0EsR0FBR0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxNQUFNQSxDQUFDQTtZQUVsREEsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsQ0FBQ0EsR0FBR0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsR0FBR0EsUUFBUUEsRUFBRUEsRUFBRUEsQ0FBQ0EsRUFBRUEsQ0FBQ0E7Z0JBQ2hDQSxJQUFJQSxJQUFJQSxHQUFHQSxLQUFLQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtnQkFDcEJBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLEVBQUVBLENBQUNBLEdBQUdBLGNBQWNBLEVBQUVBLEVBQUVBLENBQUNBLEVBQUVBLENBQUNBO29CQUN0Q0EsSUFBSUEsR0FBR0EsR0FBR0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTtvQkFDbkNBLEVBQUVBLENBQUNBLENBQUNBLEdBQUdBLENBQUNBLFlBQVlBLENBQUNBLG9CQUFvQkEsQ0FBQ0EsS0FBS0EsSUFBSUEsQ0FBQ0Esb0JBQW9CQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQTt3QkFDeEVBLEFBQ0FBLDRFQUQ0RUE7d0JBQzVFQSxJQUFJQSxDQUFDQSxLQUFLQSxDQUFDQSxHQUFHQSxDQUFDQSxDQUFDQTtvQkFDcEJBLENBQUNBO2dCQUNMQSxDQUFDQTtZQUNMQSxDQUFDQTtRQUNMQSxDQUFDQTtRQUVEQSxPQUFPQSxDQUFDQSxZQUFZQSxDQUFDQSxJQUFJQSxFQUFFQSxJQUFJQSxFQUFFQSxJQUFJQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFDQTtRQUM3Q0EsK0NBQStDQTtJQUNuREEsQ0FBQ0E7SUFFTUgsb0JBQUtBLEdBQVpBO1FBRUlJLElBQUlBLENBQUNBLGdCQUFnQkEsR0FBR0EsRUFBRUEsQ0FBQ0E7SUFDL0JBLENBQUNBO0lBRUxKOzs7Ozs7Ozs7Ozs7Ozs7Ozs7V0FrQk9BO0lBRUtBLG9CQUFLQSxHQUFiQSxVQUFjQSxVQUF5QkE7UUFFbkNLLElBQUlBLFlBQVlBLEdBQUdBLFVBQVVBLENBQUNBLFlBQVlBLENBQUNBO1FBQzNDQSxJQUFJQSxNQUFNQSxHQUFHQSxZQUFZQSxDQUFDQSxNQUFNQSxDQUFDQTtRQUNqQ0EsSUFBSUEsR0FBR0EsR0FBR0EsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0E7UUFDeEJBLElBQUlBLElBQUlBLEdBQUdBLE1BQU1BLENBQUNBLEdBQUdBLEdBQUNBLENBQUNBLENBQUNBLENBQUNBO1FBQ3pCQSxJQUFJQSxNQUFNQSxHQUFHQSxJQUFJQSxDQUFDQSxTQUFTQSxDQUFDQSxRQUFRQSxDQUFDQTtRQUVyQ0EsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsWUFBWUEsQ0FBQ0EsVUFBVUEsRUFBRUEsSUFBSUEsRUFBRUEsTUFBTUEsQ0FBQ0EsQ0FBQ0E7UUFDdERBLEFBQ0FBLGdDQURnQ0E7UUFDaENBLFVBQVVBLENBQUNBLFFBQVFBLENBQUNBLElBQUlBLEVBQUVBLE1BQU1BLEVBQUVBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLHlCQUF5QkEsQ0FBQ0EsQ0FBQ0E7UUFDNUVBLElBQUlBLENBQUNBLFNBQVNBLENBQUNBLGNBQWNBLENBQUNBLFVBQVVBLEVBQUVBLElBQUlBLENBQUNBLENBQUNBO0lBQ3BEQSxDQUFDQTtJQUNMTCxXQUFDQTtBQUFEQSxDQW5HQSxBQW1HQ0EsSUFBQTtBQUNELEFBQWMsaUJBQUwsSUFBSSxDQUFDIiwiZmlsZSI6InJlbmRlcmVyL01hc2suanMiLCJzb3VyY2VSb290IjoiLi4vIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlbmRlclRleHR1cmUgPSByZXF1aXJlKFwiYXdheWpzLWNvcmUvbGliL3RleHR1cmVzL1JlbmRlclRleHR1cmVcIik7XHJcbmltcG9ydCBEaXNwbGF5T2JqZWN0ID0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9iYXNlL0Rpc3BsYXlPYmplY3RcIik7XHJcbmltcG9ydCBSZW5kZXJhYmxlQmFzZSA9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvcG9vbC9SZW5kZXJhYmxlQmFzZVwiKTtcclxuaW1wb3J0IFJlbmRlck9iamVjdEJhc2VcdD0gcmVxdWlyZShcImF3YXlqcy1yZW5kZXJlcmdsL2xpYi9jb21waWxhdGlvbi9SZW5kZXJPYmplY3RCYXNlXCIpO1xyXG5pbXBvcnQgU3RhZ2UgPSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvU3RhZ2VcIik7XHJcbmltcG9ydCBDb250ZXh0R0xDbGVhck1hc2sgPSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvQ29udGV4dEdMQ2xlYXJNYXNrXCIpO1xyXG5cclxuaW1wb3J0IFJlbmRlcmVyMkQgPSByZXF1aXJlKFwiYXdheWpzLXBsYXllci9saWIvcmVuZGVyZXIvUmVuZGVyZXIyRFwiKTtcclxuXHJcbmNsYXNzIE1hc2tcclxue1xyXG4gICAgLy9wcml2YXRlIF90ZXh0dXJlIDogUmVuZGVyVGV4dHVyZTtcclxuICAgIHByaXZhdGUgX3N0YWdlIDogU3RhZ2U7XHJcbiAgICBwcml2YXRlIF9yZW5kZXJlciA6IFJlbmRlcmVyMkQ7XHJcbiAgICBwcml2YXRlIF9yZWdpc3RlcmVkTWFza3MgOiBSZW5kZXJhYmxlQmFzZVtdO1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKHN0YWdlOlN0YWdlLCByZW5kZXJlcjpSZW5kZXJlcjJEKVxyXG4gICAge1xyXG4gICAgICAgIHRoaXMuX3N0YWdlID0gc3RhZ2U7XHJcbiAgICAgICAgdGhpcy5fcmVuZGVyZXIgPSByZW5kZXJlcjtcclxuICAgICAgICAvL3RoaXMuX3RleHR1cmUgPSBuZXcgUmVuZGVyVGV4dHVyZShyZW5kZXJlci53aWR0aCwgcmVuZGVyZXIuaGVpZ2h0KTtcclxuICAgIH1cclxuXHJcbiAgICAvL3B1YmxpYyBnZXQgdGV4dHVyZSgpXHJcbiAgICAvL3tcclxuICAgICAgICAvL3JldHVybiB0aGlzLl90ZXh0dXJlO1xyXG4gICAgLy99XHJcblxyXG4gICAgLy9wdWJsaWMgZGlzcG9zZSgpXHJcbiAgICAvL3tcclxuICAgIC8vICAgIHRoaXMuX3RleHR1cmUuZGlzcG9zZSgpO1xyXG4gICAgLy99XHJcblxyXG4gICAgcHVibGljIHJlZ2lzdGVyTWFzayhvYmo6UmVuZGVyYWJsZUJhc2UpIDogdm9pZFxyXG4gICAge1xyXG4gICAgICAgIC8vY29uc29sZS5sb2coXCJyZWdpc3Rlck1hc2tcIik7XHJcbiAgICAgICAgdGhpcy5fcmVnaXN0ZXJlZE1hc2tzLnB1c2gob2JqKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgcmVuZGVyTWFza3MobWFza3M6RGlzcGxheU9iamVjdFtdKVxyXG4gICAge1xyXG4gICAgICAgIC8vdmFyIG9sZFJlbmRlclRhcmdldCA9IHRoaXMuX3N0YWdlLnJlbmRlclRhcmdldDtcclxuXHJcbiAgICAgICAgLy90aGlzLl9zdGFnZS5zZXRSZW5kZXJUYXJnZXQodGhpcy5fdGV4dHVyZSk7XHJcbiAgICAgICAgLy90aGlzLl9zdGFnZS5jbGVhcigpO1xyXG4gICAgICAgIHZhciBjb250ZXh0ID0gdGhpcy5fc3RhZ2UuY29udGV4dDtcclxuICAgICAgICBjb250ZXh0LnNldENvbG9yTWFzayhmYWxzZSwgZmFsc2UsIGZhbHNlLCBmYWxzZSk7XHJcbiAgICAgICAgLy8gVE9ETzogQ291bGQgd2UgY3JlYXRlIG1hc2tzIHdpdGhpbiBtYXNrcyBieSBwcm92aWRpbmcgYSBwcmV2aW91cyBjb25maWdJRCwgYW5kIHN1cHBseSBcImNsZWFyL2tlZXBcIiBvbiBzdGVuY2lsIGZhaWxcclxuICAgICAgICAvL2NvbnRleHQuc2V0U3RlbmNpbEFjdGlvbnMoXCJmcm9udEFuZEJhY2tcIiwgXCJhbHdheXNcIiwgXCJzZXRcIiwgXCJzZXRcIiwgXCJzZXRcIik7XHJcblxyXG4gICAgICAgIGlmIChtYXNrcykge1xyXG4gICAgICAgICAgICB2YXIgbnVtTWFza3MgPSBtYXNrcy5sZW5ndGg7XHJcbiAgICAgICAgICAgIHZhciBudW1SZW5kZXJhYmxlcyA9IHRoaXMuX3JlZ2lzdGVyZWRNYXNrcy5sZW5ndGg7XHJcblxyXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG51bU1hc2tzOyArK2kpIHtcclxuICAgICAgICAgICAgICAgIHZhciBtYXNrID0gbWFza3NbaV07XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8IG51bVJlbmRlcmFibGVzOyArK2opIHtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgb2JqID0gdGhpcy5fcmVnaXN0ZXJlZE1hc2tzW2pdO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChvYmouc291cmNlRW50aXR5W1wiaGllcmFyY2hpY2FsTWFza0lEXCJdID09PSBtYXNrW1wiaGllcmFyY2hpY2FsTWFza0lEXCJdKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coXCJSZW5kZXJpbmcgaGllcmFyY2hpY2FsTWFza0lEIFwiICsgbWFza1tcImhpZXJhcmNoaWNhbE1hc2tJRFwiXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuX2RyYXcob2JqKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNvbnRleHQuc2V0Q29sb3JNYXNrKHRydWUsIHRydWUsIHRydWUsIHRydWUpO1xyXG4gICAgICAgIC8vdGhpcy5fc3RhZ2Uuc2V0UmVuZGVyVGFyZ2V0KG9sZFJlbmRlclRhcmdldCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHJlc2V0KClcclxuICAgIHtcclxuICAgICAgICB0aGlzLl9yZWdpc3RlcmVkTWFza3MgPSBbXTtcclxuICAgIH1cclxuXHJcbi8qICAgIHB1YmxpYyBnZXQgd2lkdGgoKSA6IG51bWJlclxyXG4gICAge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl90ZXh0dXJlLndpZHRoO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzZXQgd2lkdGgodmFsdWU6bnVtYmVyKVxyXG4gICAge1xyXG4gICAgICAgIHRoaXMuX3RleHR1cmUud2lkdGggPSB2YWx1ZTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0IGhlaWdodCgpIDogbnVtYmVyXHJcbiAgICB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuX3RleHR1cmUuaGVpZ2h0O1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzZXQgaGVpZ2h0KHZhbHVlOm51bWJlcilcclxuICAgIHtcclxuICAgICAgICB0aGlzLl90ZXh0dXJlLmhlaWdodCA9IHZhbHVlO1xyXG4gICAgfSovXHJcblxyXG4gICAgcHJpdmF0ZSBfZHJhdyhyZW5kZXJhYmxlOlJlbmRlcmFibGVCYXNlKVxyXG4gICAge1xyXG4gICAgICAgIHZhciByZW5kZXJPYmplY3QgPSByZW5kZXJhYmxlLnJlbmRlck9iamVjdDtcclxuICAgICAgICB2YXIgcGFzc2VzID0gcmVuZGVyT2JqZWN0LnBhc3NlcztcclxuICAgICAgICB2YXIgbGVuID0gcGFzc2VzLmxlbmd0aDtcclxuICAgICAgICB2YXIgcGFzcyA9IHBhc3Nlc1tsZW4tMV07XHJcbiAgICAgICAgdmFyIGNhbWVyYSA9IHRoaXMuX3JlbmRlcmVyLl9wQ2FtZXJhO1xyXG5cclxuICAgICAgICB0aGlzLl9yZW5kZXJlci5hY3RpdmF0ZVBhc3MocmVuZGVyYWJsZSwgcGFzcywgY2FtZXJhKTtcclxuICAgICAgICAvLyBvbmx5IHJlbmRlciBsYXN0IHBhc3MgZm9yIG5vd1xyXG4gICAgICAgIHJlbmRlcmFibGUuX2lSZW5kZXIocGFzcywgY2FtZXJhLCB0aGlzLl9yZW5kZXJlci5fcFJ0dFZpZXdQcm9qZWN0aW9uTWF0cml4KTtcclxuICAgICAgICB0aGlzLl9yZW5kZXJlci5kZWFjdGl2YXRlUGFzcyhyZW5kZXJhYmxlLCBwYXNzKTtcclxuICAgIH1cclxufVxyXG5leHBvcnQgPSBNYXNrO1xyXG4iXX0=