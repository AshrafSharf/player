var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var RenderableNullSort = require("awayjs-display/lib/sort/RenderableNullSort");
var DefaultRenderer = require("awayjs-renderergl/lib/DefaultRenderer");
var Mask = require("awayjs-player/lib/renderer/Mask");
var Renderer2D = (function (_super) {
    __extends(Renderer2D, _super);
    function Renderer2D(rendererPoolClass, stage) {
        if (rendererPoolClass === void 0) { rendererPoolClass = null; }
        if (stage === void 0) { stage = null; }
        _super.call(this, rendererPoolClass, stage);
        this.renderableSorter = new RenderableNullSort();
        this._mask = new Mask(this._pStage, this);
    }
    Renderer2D.prototype.drawRenderables = function (renderable, entityCollector) {
        var i;
        var len;
        var renderable2;
        var renderObject;
        var passes;
        var pass;
        var camera = entityCollector.camera;
        var maskConfigID = undefined;
        /*// TypeScript does not allow calling super.setters -_-
        // TODO: There's no reason to stick to POT-textures, but AwayJS complains if we don't
        //this._mask.width = this._pRttBufferManager.textureWidth;
        //this._mask.height = this._pRttBufferManager.textureHeight;*/
        this._mask.reset();
        while (renderable) {
            renderObject = renderable.renderObject;
            passes = renderObject.passes;
            if (renderable.sourceEntity._iMaskID) {
                renderable2 = renderable.next;
                this._mask.registerMask(renderable);
            }
            else if (this._disableColor && renderObject._renderObjectOwner.alphaThreshold != 0) {
                renderable2 = renderable;
                do {
                    renderable2 = renderable2.next;
                } while (renderable2 && renderable2.renderObject == renderObject);
            }
            else {
                //iterate through each shader object
                len = passes.length;
                for (i = 0; i < len; i++) {
                    renderable2 = renderable;
                    var newMaskConfigID = renderable2.sourceEntity["maskConfigID"];
                    if (maskConfigID !== newMaskConfigID) {
                        if (newMaskConfigID == -1) {
                            // disable stencil
                            this._pContext.setStencilActions();
                            console.log("Let's not use stencil!");
                        }
                        else {
                            console.log("Rendering masks with configID " + newMaskConfigID);
                            this._pContext.setStencilReferenceValue(newMaskConfigID);
                            this._mask.renderMasks(renderable2.sourceEntity["hierarchicalMasks"], newMaskConfigID);
                            this._pContext.setStencilActions("frontAndBack", "equal", "keep", "keep", "keep");
                        }
                        maskConfigID = newMaskConfigID;
                    }
                    pass = passes[i];
                    this.activatePass(renderable, pass, camera);
                    do {
                        renderable2._iRender(pass, camera, this._pRttViewProjectionMatrix);
                        renderable2 = renderable2.next;
                    } while (renderable2 && renderable2.renderObject == renderObject && renderable2.sourceEntity["maskConfigID"] == maskConfigID);
                    this.deactivatePass(renderable, pass);
                }
            }
            renderable = renderable2;
        }
    };
    return Renderer2D;
})(DefaultRenderer);
module.exports = Renderer2D;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1wbGF5ZXIvbGliL3JlbmRlcmVyL1JlbmRlcmVyMkQudHMiXSwibmFtZXMiOlsiUmVuZGVyZXIyRCIsIlJlbmRlcmVyMkQuY29uc3RydWN0b3IiLCJSZW5kZXJlcjJELmRyYXdSZW5kZXJhYmxlcyJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBRUEsSUFBTyxrQkFBa0IsV0FBVyw0Q0FBNEMsQ0FBQyxDQUFDO0FBRWxGLElBQU8sZUFBZSxXQUFXLHVDQUF1QyxDQUFDLENBQUM7QUFNMUUsSUFBTyxJQUFJLFdBQVcsaUNBQWlDLENBQUMsQ0FBQztBQUV6RCxJQUFNLFVBQVU7SUFBU0EsVUFBbkJBLFVBQVVBLFVBQXdCQTtJQUlwQ0EsU0FKRUEsVUFBVUEsQ0FJQUEsaUJBQTJDQSxFQUFFQSxLQUFrQkE7UUFBL0RDLGlDQUEyQ0EsR0FBM0NBLHdCQUEyQ0E7UUFBRUEscUJBQWtCQSxHQUFsQkEsWUFBa0JBO1FBRXZFQSxrQkFBTUEsaUJBQWlCQSxFQUFFQSxLQUFLQSxDQUFDQSxDQUFDQTtRQUNoQ0EsSUFBSUEsQ0FBQ0EsZ0JBQWdCQSxHQUFHQSxJQUFJQSxrQkFBa0JBLEVBQUVBLENBQUNBO1FBQ2pEQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxJQUFJQSxJQUFJQSxDQUFDQSxJQUFJQSxDQUFDQSxPQUFPQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFDQTtJQUM5Q0EsQ0FBQ0E7SUFFTUQsb0NBQWVBLEdBQXRCQSxVQUF1QkEsVUFBeUJBLEVBQUVBLGVBQTZCQTtRQUUzRUUsSUFBSUEsQ0FBUUEsQ0FBQ0E7UUFDYkEsSUFBSUEsR0FBVUEsQ0FBQ0E7UUFDZkEsSUFBSUEsV0FBMEJBLENBQUNBO1FBQy9CQSxJQUFJQSxZQUE2QkEsQ0FBQ0E7UUFDbENBLElBQUlBLE1BQTRCQSxDQUFDQTtRQUNqQ0EsSUFBSUEsSUFBbUJBLENBQUNBO1FBQ3hCQSxJQUFJQSxNQUFNQSxHQUFVQSxlQUFlQSxDQUFDQSxNQUFNQSxDQUFDQTtRQUMzQ0EsSUFBSUEsWUFBWUEs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Q0FBQ0E7b0JBRTVDQSxHQUFHQSxDQUFDQTt3QkFDQUEsV0FBV0EsQ0FBQ0EsUUFBUUEsQ0FBQ0EsSUFBSUEsRUFBRUEsTUFBTUEsRUFBRUEsSUFBSUEsQ0FBQ0EseUJBQXlCQSxDQUFDQSxDQUFDQTt3QkFDbkVBLFdBQVdBLEdBQUdBLFdBQVdBLENBQUNBLElBQUlBLENBQUNBO29CQUVuQ0EsQ0FBQ0EsUUFBUUEsV0FBV0EsSUFBSUEsV0FBV0EsQ0FBQ0EsWUFBWUEsSUFBSUEsWUFBWUEsSUFBSUEsV0FBV0EsQ0FBQ0EsWUFBWUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsSUFBSUEsWUFBWUEsRUFBRUE7b0JBRTlIQSxJQUFJQSxDQUFDQSxjQUFjQSxDQUFDQSxVQUFVQSxFQUFFQSxJQUFJQSxDQUFDQSxDQUFDQTtnQkFDMUNBLENBQUNBO1lBQ0xBLENBQUNBO1lBRURBLFVBQVVBLEdBQUdBLFdBQVdBLENBQUNBO1FBQzdCQSxDQUFDQTtJQUNMQSxDQUFDQTtJQVFMRixpQkFBQ0E7QUFBREEsQ0ExRkEsQUEwRkNBLEVBMUZ3QixlQUFlLEVBMEZ2QztBQUNELEFBQW9CLGlCQUFYLFVBQVUsQ0FBQyIsImZpbGUiOiJyZW5kZXJlci9SZW5kZXJlcjJELmpzIiwic291cmNlUm9vdCI6Ii4uLyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBDYW1lcmEgPSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL0NhbWVyYVwiKTtcclxuaW1wb3J0IENvbGxlY3RvckJhc2UgPSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL3RyYXZlcnNlL0NvbGxlY3RvckJhc2VcIik7XHJcbmltcG9ydCBSZW5kZXJhYmxlTnVsbFNvcnQgPSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL3NvcnQvUmVuZGVyYWJsZU51bGxTb3J0XCIpO1xyXG5pbXBvcnQgU3RhZ2UgPSByZXF1aXJlKFwiYXdheWpzLXN0YWdlZ2wvbGliL2Jhc2UvU3RhZ2VcIik7XHJcbmltcG9ydCBEZWZhdWx0UmVuZGVyZXIgPSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL0RlZmF1bHRSZW5kZXJlclwiKTtcclxuaW1wb3J0IElSZW5kZXJlclBvb2xDbGFzcyA9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvcG9vbC9JUmVuZGVyZXJQb29sQ2xhc3NcIik7XHJcbmltcG9ydCBSZW5kZXJhYmxlQmFzZSA9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvcG9vbC9SZW5kZXJhYmxlQmFzZVwiKTtcclxuaW1wb3J0IFJlbmRlck9iamVjdEJhc2UgICAgPSByZXF1aXJlKFwiYXdheWpzLXJlbmRlcmVyZ2wvbGliL2NvbXBpbGF0aW9uL1JlbmRlck9iamVjdEJhc2VcIik7XHJcbmltcG9ydCBSZW5kZXJQYXNzQmFzZSA9IHJlcXVpcmUoXCJhd2F5anMtcmVuZGVyZXJnbC9saWIvcGFzc2VzL1JlbmRlclBhc3NCYXNlXCIpO1xyXG5cclxuaW1wb3J0IE1hc2sgPSByZXF1aXJlKFwiYXdheWpzLXBsYXllci9saWIvcmVuZGVyZXIvTWFza1wiKTtcclxuXHJcbmNsYXNzIFJlbmRlcmVyMkQgZXh0ZW5kcyBEZWZhdWx0UmVuZGVyZXJcclxue1xyXG4gICAgcHJpdmF0ZSBfbWFzayA6IE1hc2s7XHJcblxyXG4gICAgY29uc3RydWN0b3IocmVuZGVyZXJQb29sQ2xhc3M6SVJlbmRlcmVyUG9vbENsYXNzID0gbnVsbCwgc3RhZ2U6U3RhZ2UgPSBudWxsKVxyXG4gICAge1xyXG4gICAgICAgIHN1cGVyKHJlbmRlcmVyUG9vbENsYXNzLCBzdGFnZSk7XHJcbiAgICAgICAgdGhpcy5yZW5kZXJhYmxlU29ydGVyID0gbmV3IFJlbmRlcmFibGVOdWxsU29ydCgpO1xyXG4gICAgICAgIHRoaXMuX21hc2sgPSBuZXcgTWFzayh0aGlzLl9wU3RhZ2UsIHRoaXMpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBkcmF3UmVuZGVyYWJsZXMocmVuZGVyYWJsZTpSZW5kZXJhYmxlQmFzZSwgZW50aXR5Q29sbGVjdG9yOkNvbGxlY3RvckJhc2UpXHJcbiAgICB7XHJcbiAgICAgICAgdmFyIGk6bnVtYmVyO1xyXG4gICAgICAgIHZhciBsZW46bnVtYmVyO1xyXG4gICAgICAgIHZhciByZW5kZXJhYmxlMjpSZW5kZXJhYmxlQmFzZTtcclxuICAgICAgICB2YXIgcmVuZGVyT2JqZWN0OlJlbmRlck9iamVjdEJhc2U7XHJcbiAgICAgICAgdmFyIHBhc3NlczpBcnJheTxSZW5kZXJQYXNzQmFzZT47XHJcbiAgICAgICAgdmFyIHBhc3M6UmVuZGVyUGFzc0Jhc2U7XHJcbiAgICAgICAgdmFyIGNhbWVyYTpDYW1lcmEgPSBlbnRpdHlDb2xsZWN0b3IuY2FtZXJhO1xyXG4gICAgICAgIHZhciBtYXNrQ29uZmlnSUQ6bnVtYmVyID0gdW5kZWZpbmVkO1xyXG5cclxuICAgICAgICAvKi8vIFR5cGVTY3JpcHQgZG9lcyBub3QgYWxsb3cgY2FsbGluZyBzdXBlci5zZXR0ZXJzIC1fLVxyXG4gICAgICAgIC8vIFRPRE86IFRoZXJlJ3Mgbm8gcmVhc29uIHRvIHN0aWNrIHRvIFBPVC10ZXh0dXJlcywgYnV0IEF3YXlKUyBjb21wbGFpbnMgaWYgd2UgZG9uJ3RcclxuICAgICAgICAvL3RoaXMuX21hc2sud2lkdGggPSB0aGlzLl9wUnR0QnVmZmVyTWFuYWdlci50ZXh0dXJlV2lkdGg7XHJcbiAgICAgICAgLy90aGlzLl9tYXNrLmhlaWdodCA9IHRoaXMuX3BSdHRCdWZmZXJNYW5hZ2VyLnRleHR1cmVIZWlnaHQ7Ki9cclxuICAgICAgICB0aGlzLl9tYXNrLnJlc2V0KCk7XHJcblxyXG4gICAgICAgIHdoaWxlIChyZW5kZXJhYmxlKSB7XHJcbiAgICAgICAgICAgIHJlbmRlck9iamVjdCA9IHJlbmRlcmFibGUucmVuZGVyT2JqZWN0O1xyXG4gICAgICAgICAgICBwYXNzZXMgPSByZW5kZXJPYmplY3QucGFzc2VzO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYgKHJlbmRlcmFibGUuc291cmNlRW50aXR5Ll9pTWFza0lEKSB7XHJcbiAgICAgICAgICAgICAgICByZW5kZXJhYmxlMiA9IHJlbmRlcmFibGUubmV4dDtcclxuICAgICAgICAgICAgICAgIHRoaXMuX21hc2sucmVnaXN0ZXJNYXNrKHJlbmRlcmFibGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIG90aGVyd2lzZSB0aGlzIHdvdWxkIHJlc3VsdCBpbiBkZXB0aCByZW5kZXJlZCBhbnl3YXkgYmVjYXVzZSBmcmFnbWVudCBzaGFkZXIga2lsIGlzIGlnbm9yZWRcclxuICAgICAgICAgICAgZWxzZSBpZiAodGhpcy5fZGlzYWJsZUNvbG9yICYmIHJlbmRlck9iamVjdC5fcmVuZGVyT2JqZWN0T3duZXIuYWxwaGFUaHJlc2hvbGQgIT0gMCkge1xyXG4gICAgICAgICAgICAgICAgcmVuZGVyYWJsZTIgPSByZW5kZXJhYmxlO1xyXG4gICAgICAgICAgICAgICAgLy8gZmFzdCBmb3J3YXJkXHJcbiAgICAgICAgICAgICAgICBkbyB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVuZGVyYWJsZTIgPSByZW5kZXJhYmxlMi5uZXh0O1xyXG4gICAgICAgICAgICAgICAgfSB3aGlsZSAocmVuZGVyYWJsZTIgJiYgcmVuZGVyYWJsZTIucmVuZGVyT2JqZWN0ID09IHJlbmRlck9iamVjdCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvL2l0ZXJhdGUgdGhyb3VnaCBlYWNoIHNoYWRlciBvYmplY3RcclxuICAgICAgICAgICAgICAgIGxlbiA9IHBhc3Nlcy5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICBmb3IgKGkgPSAwOyBpIDwgbGVuOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgICByZW5kZXJhYmxlMiA9IHJlbmRlcmFibGU7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5ld01hc2tDb25maWdJRCA9IHJlbmRlcmFibGUyLnNvdXJjZUVudGl0eVtcIm1hc2tDb25maWdJRFwiXTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKG1hc2tDb25maWdJRCAhPT0gbmV3TWFza0NvbmZpZ0lEKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChuZXdNYXNrQ29uZmlnSUQgPT0gLTEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRpc2FibGUgc3RlbmNpbFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcENvbnRleHQuc2V0U3RlbmNpbEFjdGlvbnMoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiTGV0J3Mgbm90IHVzZSBzdGVuY2lsIVwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiUmVuZGVyaW5nIG1hc2tzIHdpdGggY29uZmlnSUQgXCIgKyBuZXdNYXNrQ29uZmlnSUQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcENvbnRleHQuc2V0U3RlbmNpbFJlZmVyZW5jZVZhbHVlKG5ld01hc2tDb25maWdJRCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9tYXNrLnJlbmRlck1hc2tzKHJlbmRlcmFibGUyLnNvdXJjZUVudGl0eVtcImhpZXJhcmNoaWNhbE1hc2tzXCJdLCBuZXdNYXNrQ29uZmlnSUQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fcENvbnRleHQuc2V0U3RlbmNpbEFjdGlvbnMoXCJmcm9udEFuZEJhY2tcIiwgXCJlcXVhbFwiLCBcImtlZXBcIiwgXCJrZWVwXCIsIFwia2VlcFwiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXNrQ29uZmlnSUQgPSBuZXdNYXNrQ29uZmlnSUQ7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgICAgICBwYXNzID0gcGFzc2VzW2ldO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFjdGl2YXRlUGFzcyhyZW5kZXJhYmxlLCBwYXNzLCBjYW1lcmEpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICBkbyB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlbmRlcmFibGUyLl9pUmVuZGVyKHBhc3MsIGNhbWVyYSwgdGhpcy5fcFJ0dFZpZXdQcm9qZWN0aW9uTWF0cml4KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVuZGVyYWJsZTIgPSByZW5kZXJhYmxlMi5uZXh0O1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB9IHdoaWxlIChyZW5kZXJhYmxlMiAmJiByZW5kZXJhYmxlMi5yZW5kZXJPYmplY3QgPT0gcmVuZGVyT2JqZWN0ICYmIHJlbmRlcmFibGUyLnNvdXJjZUVudGl0eVtcIm1hc2tDb25maWdJRFwiXSA9PSBtYXNrQ29uZmlnSUQpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmRlYWN0aXZhdGVQYXNzKHJlbmRlcmFibGUsIHBhc3MpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZW5kZXJhYmxlID0gcmVuZGVyYWJsZTI7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvKnB1YmxpYyBkaXNwb3NlKClcclxuICAgIHtcclxuICAgICAgICBzdXBlci5kaXNwb3NlKCk7XHJcbiAgICAgICAgdGhpcy5fbWFzay5kaXNwb3NlKCk7XHJcbiAgICB9Ki9cclxufVxyXG5leHBvcnQgPSBSZW5kZXJlcjJEOyJdfQ==