var __extends = this.__extends || function (d, b) {
    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];
    function __() { this.constructor = d; }
    __.prototype = b.prototype;
    d.prototype = new __();
};
var DisplayObjectContainer = require("awayjs-display/lib/containers/DisplayObjectContainer");
var NodeBase = require("awayjs-display/lib/partition/NodeBase");
// Warning: contains horrible hacks
var Partition2DNode = (function (_super) {
    __extends(Partition2DNode, _super);
    function Partition2DNode(root) {
        _super.call(this);
        this._root = root;
    }
    Partition2DNode.prototype.acceptTraverser = function (traverser) {
        this._maskConfigID = 0;
        if (traverser.enterNode(this)) {
            this.traverseSceneGraph(this._root, traverser);
        }
    };
    // pass any so we can convert to IEntity. Sigh, TypeScript.
    Partition2DNode.prototype.traverseSceneGraph = function (displayObject, traverser, maskID, appliedMasks) {
        if (maskID === void 0) { maskID = -1; }
        if (appliedMasks === void 0) { appliedMasks = null; }
        if (displayObject._iMaskID != -1) {
            if (maskID != -1)
                throw "masks within masker currently not supported";
            maskID = displayObject._iMaskID;
            // TODO: this could be implemented similar to implicit mouse enabled, partition, and other parent-child-propagated properties
            // just not sure if we want to keep it like this
            console.log(maskID);
        }
        else {
            console.log(displayObject._iMasks);
            if (displayObject._iMasks) {
                appliedMasks = appliedMasks ? appliedMasks.concat(displayObject._iMasks) : displayObject._iMasks.concat();
                // signify that applied masks have changed
                ++this._maskConfigID;
            }
        }
        displayObject["hierarchicalMaskID"] = maskID;
        displayObject["hierarchicalMasks"] = appliedMasks;
        displayObject["maskConfigID"] = this._maskConfigID;
        // moving back up the tree, mask will change again
        if (displayObject._iMasks)
            ++this._maskConfigID;
        // typechecking is nasty, but we have little choice:
        if (displayObject instanceof DisplayObjectContainer)
            this.traverseChildren(displayObject, traverser, maskID, appliedMasks);
        if (displayObject.isEntity) {
            var entity = displayObject;
            entity["node2D"].acceptTraverser(traverser);
        }
    };
    Partition2DNode.prototype.traverseChildren = function (container, traverser, maskID, appliedMasks) {
        var len = container.numChildren;
        for (var i = 0; i < len; ++i)
            this.traverseSceneGraph(container.getChildAt(i), traverser, maskID, appliedMasks);
    };
    Partition2DNode.prototype.iAddNode = function (node) {
        _super.prototype.iAddNode.call(this, node);
        var entityNode = (node);
        entityNode.entity["node2D"] = node;
    };
    return Partition2DNode;
})(NodeBase);
module.exports = Partition2DNode;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF3YXlqcy1wbGF5ZXIvbGliL3BhcnRpdGlvbi9QYXJ0aXRpb24yRE5vZGUudHMiXSwibmFtZXMiOlsiUGFydGl0aW9uMkROb2RlIiwiUGFydGl0aW9uMkROb2RlLmNvbnN0cnVjdG9yIiwiUGFydGl0aW9uMkROb2RlLmFjY2VwdFRyYXZlcnNlciIsIlBhcnRpdGlvbjJETm9kZS50cmF2ZXJzZVNjZW5lR3JhcGgiLCJQYXJ0aXRpb24yRE5vZGUudHJhdmVyc2VDaGlsZHJlbiIsIlBhcnRpdGlvbjJETm9kZS5pQWRkTm9kZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBR0EsSUFBTyxzQkFBc0IsV0FBVyxzREFBc0QsQ0FBQyxDQUFDO0FBQ2hHLElBQU8sUUFBUSxXQUFXLHVDQUF1QyxDQUFDLENBQUM7QUFHbkUsQUFDQSxtQ0FEbUM7SUFDN0IsZUFBZTtJQUFTQSxVQUF4QkEsZUFBZUEsVUFBaUJBO0lBS2xDQSxTQUxFQSxlQUFlQSxDQUtMQSxJQUFrQkE7UUFFMUJDLGlCQUFPQSxDQUFDQTtRQUNSQSxJQUFJQSxDQUFDQSxLQUFLQSxHQUFHQSxJQUFJQSxDQUFDQTtJQUN0QkEsQ0FBQ0E7SUFFTUQseUNBQWVBLEdBQXRCQSxVQUF1QkEsU0FBdUJBO1FBRTFDRSxJQUFJQSxDQUFDQSxhQUFhQSxHQUFHQSxDQUFDQSxDQUFDQTtRQUN2QkEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsU0FBU0EsQ0FBQ0EsU0FBU0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDNUJBLElBQUlBLENBQUNBLGtCQUFrQkEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsRUFBRUEsU0FBU0EsQ0FBQ0EsQ0FBQ0E7UUFDbkRBLENBQUNBO0lBQ0xBLENBQUNBO0lBRURGLDJEQUEyREE7SUFDcERBLDRDQUFrQkEsR0FBekJBLFVBQTBCQSxhQUFpQkEsRUFBRUEsU0FBdUJBLEVBQUVBLE1BQWtCQSxFQUFFQSxZQUFtQ0E7UUFBdkRHLHNCQUFrQkEsR0FBbEJBLFVBQWlCQSxDQUFD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QVVBLENBQUNBLE1BQU1BLENBQUNBLFFBQVFBLENBQUNBLEdBQUdBLElBQUlBLENBQUNBO0lBQ3ZDQSxDQUFDQTtJQUNMTCxzQkFBQ0E7QUFBREEsQ0F2RUEsQUF1RUNBLEVBdkU2QixRQUFRLEVBdUVyQztBQUNELEFBQXlCLGlCQUFoQixlQUFlLENBQUMiLCJmaWxlIjoicGFydGl0aW9uL1BhcnRpdGlvbjJETm9kZS5qcyIsInNvdXJjZVJvb3QiOiIuLi8iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQ29sbGVjdG9yQmFzZSA9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvdHJhdmVyc2UvQ29sbGVjdG9yQmFzZVwiKTtcclxuaW1wb3J0IERpc3BsYXlPYmplY3QgPSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2Jhc2UvRGlzcGxheU9iamVjdFwiKTtcclxuaW1wb3J0IElFbnRpdHkgPSByZXF1aXJlKFwiYXdheWpzLWRpc3BsYXkvbGliL2VudGl0aWVzL0lFbnRpdHlcIik7XHJcbmltcG9ydCBEaXNwbGF5T2JqZWN0Q29udGFpbmVyID0gcmVxdWlyZShcImF3YXlqcy1kaXNwbGF5L2xpYi9jb250YWluZXJzL0Rpc3BsYXlPYmplY3RDb250YWluZXJcIik7XHJcbmltcG9ydCBOb2RlQmFzZSA9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvcGFydGl0aW9uL05vZGVCYXNlXCIpO1xyXG5pbXBvcnQgRW50aXR5Tm9kZSA9IHJlcXVpcmUoXCJhd2F5anMtZGlzcGxheS9saWIvcGFydGl0aW9uL0VudGl0eU5vZGVcIik7XHJcblxyXG4vLyBXYXJuaW5nOiBjb250YWlucyBob3JyaWJsZSBoYWNrc1xyXG5jbGFzcyBQYXJ0aXRpb24yRE5vZGUgZXh0ZW5kcyBOb2RlQmFzZVxyXG57XHJcbiAgICBwcml2YXRlIF9yb290IDogRGlzcGxheU9iamVjdDtcclxuICAgIHByaXZhdGUgX21hc2tDb25maWdJRCA6IG51bWJlcjtcclxuXHJcbiAgICBjb25zdHJ1Y3Rvcihyb290OkRpc3BsYXlPYmplY3QpXHJcbiAgICB7XHJcbiAgICAgICAgc3VwZXIoKTtcclxuICAgICAgICB0aGlzLl9yb290ID0gcm9vdDtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgYWNjZXB0VHJhdmVyc2VyKHRyYXZlcnNlcjpDb2xsZWN0b3JCYXNlKVxyXG4gICAge1xyXG4gICAgICAgIHRoaXMuX21hc2tDb25maWdJRCA9IDA7XHJcbiAgICAgICAgaWYgKHRyYXZlcnNlci5lbnRlck5vZGUodGhpcykpIHtcclxuICAgICAgICAgICAgdGhpcy50cmF2ZXJzZVNjZW5lR3JhcGgodGhpcy5fcm9vdCwgdHJhdmVyc2VyKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgLy8gcGFzcyBhbnkgc28gd2UgY2FuIGNvbnZlcnQgdG8gSUVudGl0eS4gU2lnaCwgVHlwZVNjcmlwdC5cclxuICAgIHB1YmxpYyB0cmF2ZXJzZVNjZW5lR3JhcGgoZGlzcGxheU9iamVjdDphbnksIHRyYXZlcnNlcjpDb2xsZWN0b3JCYXNlLCBtYXNrSUQ6bnVtYmVyID0gLTEsIGFwcGxpZWRNYXNrczpEaXNwbGF5T2JqZWN0W10gPSBudWxsKVxyXG4gICAge1xyXG4gICAgICAgIGlmIChkaXNwbGF5T2JqZWN0Ll9pTWFza0lEICE9IC0xKSB7XHJcbiAgICAgICAgICAgIGlmIChtYXNrSUQgIT0gLTEpIHRocm93IFwibWFza3Mgd2l0aGluIG1hc2tlciBjdXJyZW50bHkgbm90IHN1cHBvcnRlZFwiO1xyXG4gICAgICAgICAgICBtYXNrSUQgPSBkaXNwbGF5T2JqZWN0Ll9pTWFza0lEO1xyXG5cclxuICAgICAgICAgICAgLy8gVE9ETzogdGhpcyBjb3VsZCBiZSBpbXBsZW1lbnRlZCBzaW1pbGFyIHRvIGltcGxpY2l0IG1vdXNlIGVuYWJsZWQsIHBhcnRpdGlvbiwgYW5kIG90aGVyIHBhcmVudC1jaGlsZC1wcm9wYWdhdGVkIHByb3BlcnRpZXNcclxuICAgICAgICAgICAgLy8ganVzdCBub3Qgc3VyZSBpZiB3ZSB3YW50IHRvIGtlZXAgaXQgbGlrZSB0aGlzXHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKG1hc2tJRCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhkaXNwbGF5T2JqZWN0Ll9pTWFza3MpO1xyXG4gICAgICAgICAgICBpZiAoZGlzcGxheU9iamVjdC5faU1hc2tzKSB7XHJcbiAgICAgICAgICAgICAgICBhcHBsaWVkTWFza3MgPSBhcHBsaWVkTWFza3M/IGFwcGxpZWRNYXNrcy5jb25jYXQoZGlzcGxheU9iamVjdC5faU1hc2tzKSA6IGRpc3BsYXlPYmplY3QuX2lNYXNrcy5jb25jYXQoKTtcclxuICAgICAgICAgICAgICAgIC8vIHNpZ25pZnkgdGhhdCBhcHBsaWVkIG1hc2tzIGhhdmUgY2hhbmdlZFxyXG4gICAgICAgICAgICAgICAgKyt0aGlzLl9tYXNrQ29uZmlnSUQ7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGRpc3BsYXlPYmplY3RbXCJoaWVyYXJjaGljYWxNYXNrSURcIl0gPSBtYXNrSUQ7XHJcbiAgICAgICAgZGlzcGxheU9iamVjdFtcImhpZXJhcmNoaWNhbE1hc2tzXCJdID0gYXBwbGllZE1hc2tzO1xyXG4gICAgICAgIGRpc3BsYXlPYmplY3RbXCJtYXNrQ29uZmlnSURcIl0gPSB0aGlzLl9tYXNrQ29uZmlnSUQ7XHJcblxyXG4gICAgICAgIC8vIG1vdmluZyBiYWNrIHVwIHRoZSB0cmVlLCBtYXNrIHdpbGwgY2hhbmdlIGFnYWluXHJcbiAgICAgICAgaWYgKGRpc3BsYXlPYmplY3QuX2lNYXNrcylcclxuICAgICAgICAgICAgKyt0aGlzLl9tYXNrQ29uZmlnSUQ7XHJcblxyXG4gICAgICAgIC8vIHR5cGVjaGVja2luZyBpcyBuYXN0eSwgYnV0IHdlIGhhdmUgbGl0dGxlIGNob2ljZTpcclxuICAgICAgICBpZiAoZGlzcGxheU9iamVjdCBpbnN0YW5jZW9mIERpc3BsYXlPYmplY3RDb250YWluZXIpXHJcbiAgICAgICAgICAgIHRoaXMudHJhdmVyc2VDaGlsZHJlbig8RGlzcGxheU9iamVjdENvbnRhaW5lcj5kaXNwbGF5T2JqZWN0LCB0cmF2ZXJzZXIsIG1hc2tJRCwgYXBwbGllZE1hc2tzKTtcclxuXHJcbiAgICAgICAgaWYgKGRpc3BsYXlPYmplY3QuaXNFbnRpdHkpIHtcclxuICAgICAgICAgICAgdmFyIGVudGl0eSA6IElFbnRpdHkgPSA8SUVudGl0eT5kaXNwbGF5T2JqZWN0O1xyXG4gICAgICAgICAgICBlbnRpdHlbXCJub2RlMkRcIl0uYWNjZXB0VHJhdmVyc2VyKHRyYXZlcnNlcik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgdHJhdmVyc2VDaGlsZHJlbihjb250YWluZXI6RGlzcGxheU9iamVjdENvbnRhaW5lciwgdHJhdmVyc2VyOkNvbGxlY3RvckJhc2UsIG1hc2tJRDpudW1iZXIsIGFwcGxpZWRNYXNrczpEaXNwbGF5T2JqZWN0W10pXHJcbiAgICB7XHJcbiAgICAgICAgdmFyIGxlbiA9IGNvbnRhaW5lci5udW1DaGlsZHJlbjtcclxuXHJcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsZW47ICsraSlcclxuICAgICAgICAgICAgdGhpcy50cmF2ZXJzZVNjZW5lR3JhcGgoY29udGFpbmVyLmdldENoaWxkQXQoaSksIHRyYXZlcnNlciwgbWFza0lELCBhcHBsaWVkTWFza3MpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBpQWRkTm9kZShub2RlOk5vZGVCYXNlKVxyXG4gICAge1xyXG4gICAgICAgIHN1cGVyLmlBZGROb2RlKG5vZGUpO1xyXG4gICAgICAgIHZhciBlbnRpdHlOb2RlID0gPEVudGl0eU5vZGU+KG5vZGUpO1xyXG4gICAgICAgIGVudGl0eU5vZGUuZW50aXR5W1wibm9kZTJEXCJdID0gbm9kZTtcclxuICAgIH1cclxufVxyXG5leHBvcnQgPSBQYXJ0aXRpb24yRE5vZGU7Il19